<form ng-submit="submitPerson($event)" tb-validation-facade="vf">
  <fieldset ng-disabled="busy">
    <div class="form-group name" ng-class="{'has-error': vf.isError('name')}">
      <label for="name" class="control-label">Name</label>
      <input type="text" class="form-control" id="name" name="name" ng-model="person.name">
      <p class="help-block" ng-if="vf.isError('name')">{{vf.getFieldError('name')}}</p>
    </div>
    <tb-list-editor for="person.memberships" as="membershipsEditor">
      <div id="no-memberships-alert" class="alert alert-info" ng-if="person.memberships.length === 0">
        This person does not have any memberships so far.
      </div>
      <div id="got-memberships-container" class="form-group" ng-class="{'has-error': vf.isError('members')}" ng-if="person.memberships.length > 0">
        <ul id="memberships-list" class="list-unstyled">
          <li ng-class="'membership-' + {{$index}}" ng-repeat="membership in person.memberships | orderBy:'team.id'">
            <div class="form-group form-inline">
              <input type="text" ng-model="membership.role" class="form-control input-sm membership-role">
              in
              <strong class="team-name">{{membership.team.name}}</strong>
              <button type="button" ng-click="membershipsEditor.removeItem(membership)" class="btn btn-danger remove-membership-button">Remove</button>
            </div>
          </li>
        </ul>
        <p class="help-block" ng-if="vf.isError('memberships')">{{vf.getFieldError('memberships')}}</p>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">Add a new membership</h4>
        </div>
        <div class="panel-body">
          <ng-form class="form-group form-inline">
            <div class="form-group">
              <label for="new-membership-name">Name</label>
              <input type="text"
                id="new-membership-name"
                ng-model="membershipsEditor.newItem.team"
                typeahead="team as team.name for team in searchTeams($viewValue)"
                typeahead-editable="false"
                typeahead-template-url="people/commons/teamLookupItem.html"
                class="form-control">
            </div>
            <div class="form-group">
              <label for="new-membership-role">Role</label>
              <input type="text" id="new-membership-role" ng-model="membershipsEditor.newItem.role" class="form-control">
            </div>
            <button type="button" ng-click="membershipsEditor.addItem()" ng-disabled="!canAddMembership(membershipsEditor.newItem)" id="add-membership-button" class="btn btn-success">Add</button>
          </ng-form>
        </div>
      </div>
    </tb-list-editor>

    <div class="form-group">
      <button type="submit" id="submit-person-button" class="btn btn-default">{{submitTitle}}</button>
    </div>
  </fieldset>
</form>
