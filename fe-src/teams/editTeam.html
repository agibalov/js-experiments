<h3 class="page-header">{{pageTitle}}</h3>
<form tb-submit="submitTeam(team)" novalidate expose-errors-as="vf">
  <fieldset ng-disabled="busy">
    <img ng-src="{{team.avatar}}">
    <div class="form-group name" ng-class="{'has-error': vf.isError('name')}">
      <label for="name" class="control-label">Name</label>
      <input type="text" class="form-control" id="name" name="name" ng-model="team.name">
      <p class="help-block" ng-if="vf.isError('name')">{{vf.getFieldError('name')}}</p>
    </div>
    <tb-list-editor for="team.members" as="membersEditor">
      <div id="no-members-alert" class="alert alert-info" ng-if="team.members.length === 0">
        There are no members in this team so far.
      </div>
      <div id="got-members-container" class="form-group" ng-class="{'has-error': vf.isError('members')}" ng-if="team.members.length > 0">
        <div class="media form-group" ng-class="'member-' + {{$index}}" ng-repeat="member in team.members | orderBy:'person.id'">
          <div class="media-left">
            <a ng-href="/people/{{member.person.id}}">
              <!-- TODO: extract width/height style -->
              <img class="media-object" ng-src="{{member.person.avatar}}" style="width: 64px; height: 64px;">
            </a>
          </div>
          <div class="media-body">
            <a href="/people/{{member.person.id}}"><h4 class="media-heading">{{member.person.name}} <small>{{member.person.position}}</small></h4></a>
            <div class="form-inline">
              <div class="form-group">
                <input type="text" ng-model="member.role" class="form-control input-sm member-role">
              </div>
              <div class="form-group">
                <button type="button" ng-click="membersEditor.removeItem(member)" class="btn btn-danger btn-sm remove-member-button">Remove</button>
              </div>
            </div>
          </div>
        </div>
        <p class="help-block" ng-if="vf.isError('members')">{{vf.getFieldError('members')}}</p>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">Add a new member</h4>
        </div>
        <div class="panel-body">
          <ng-form class="form-group form-inline" name="addMemberForm">
            <div class="form-group">
              <label for="new-member-name">Name</label>
              <input type="text"
                ng-required="true"
                id="new-member-name"
                ng-model="membersEditor.newItem.person"
                typeahead="person as person.name for person in findPeopleByQuery($viewValue)"
                typeahead-editable="false"
                typeahead-template-url="teams/personLookupItem.html"
                class="form-control">
            </div>
            <div class="form-group">
              <label for="new-member-role">Role</label>
              <input type="text" ng-required="true" id="new-member-role" ng-model="membersEditor.newItem.role" class="form-control">
            </div>
            <button type="button" ng-click="membersEditor.addItem()" ng-disabled="addMemberForm.$invalid" id="add-member-button" class="btn btn-success">Add</button>
          </ng-form>
        </div>
      </div>
    </tb-list-editor>

    <div class="form-group">
      <button type="submit" id="submit-team-button" class="btn btn-default">{{submitTitle}}</button>
    </div>
  </fieldset>
</form>
